---
title: Modifiez la mise √† jour de la t√¢che avec HTTP Client
description: D√©couvrez comment mettre √† jour une t√¢che de la liste √† l'aide de HTTP Client dans une application Angular.
---

import { Steps } from '@astrojs/starlight/components';
import Objective from '../../../../../components/learning-objective.astro';

<Objective class="drop-shadow-xl" objectives={[
    {mainTitle: 'Objectifs de ce chapitre', title: 'Modifiez la mise √† jour de la t√¢che avec HTTP Client', description: 'Apprenez comment mettre √† jour une t√¢che de la liste en utilisant HTTP Client dans une application Angular.'},
]} />

En plus de cibler la mise √† jour d'une t√¢che plut√¥t que sa cr√©ation, cette le√ßon sera assez similaire √† la pr√©c√©dente :

- Vous mettrez √† jour **TaskService**;
- Vous mettrez √† jour **TaskFormComponent** en faisant attention √† la requ√™te HTTP asynchrone.

## TaskService

Bas√© sur le protocole HTTP, vous utiliserez la fonction **put** pour ajouter une t√¢che √† la liste : **http.put()**.
Cette fonction attend 2 param√®tres¬†:

1. L'URL du serveur API; Cette URL inclura l'identifiant de la t√¢che √† mettre √† jour¬†: `http://localhost:3000/tasks/${task.id}`
2. L'objet de la t√¢che √† envoyer au serveur

```typescript
updateTask(task: Task) {
  return this.http.post<Task>(`${http://localhost:3000/tasks/${task.id}}`, task);
}
```

### üéì Instructions

<Steps>

1. Modifiez le fichier **task.service.ts**.

    ```typescript ins={"Add the addTask function": 10-16}
    import { Injectable } from '@angular/core';
    import { HttpClient } from '@angular/common/http';
    import { Task, TaskForm } from './task.model';

    @Injectable({
        providedIn: 'root'
    })
    export class TaskService {
        constructor(private http: HttpClient) { }

        updateTask(task: Task) {
            return this.http.post<Task>(`${http://localhost:3000/tasks/${task.id}}`, task);
        }
    }
    ```

</Steps>

## TaskFormComponent

Modifiez **TaskFormComponent** pour qu'il utilise la nouvelle fonction.
Le moyen le plus simple de le faire serait d'appliquer la m√™me logique que dans la le√ßon pr√©c√©dente, en mettant √† jour la fonction **submit** pour effectuer un appel API et acc√©der √† la page de liste.

Cela donnerait le code suivant¬†:

```typescript ins={"Update the submit function": 3-6}
submit(task: TaskForm) {
    if (task.id) {

        this.taskService.updateTask(task).subscribe(() => {
            this.router.navigate(['/']);
        });
    } else {
        this.taskService.addTask(task).subscribe(() => {
            this.router.navigate(['/']);
        });
    }
}
```

Cela fonctionne mais ce n'est pas la meilleure fa√ßon de proc√©der car nous dupliquons la logique de navigation. Si le chemin de la page de liste change, nous devrons le mettre √† jour √† deux endroits.
G√©rez-le en modifiant la fonction **submit**¬†:

- Cr√©ez une variable dont la valeur sera soit la fonction **updateTask** ou **addTask**. Sa valeur sera donc une **Observable** auquelle vous pourrez vous abonner.
- Abonnez-vous √† cette variable et acc√©dez √† la page de la liste.

### üéì Instructions

<Steps>

1. Modifiez le fichier **task-form.component.ts**.

    ```typescript ins={"Update the submit function": 3-15}
    import { Component, OnInit } from '@angular/core';
    import { Router } from '@angular/router';
    import { TaskForm } from '../task.model';
    import { TaskService } from '../task.service';

    @Component({
        selector: 'app-task-form',
        templateUrl: './task-form.component.html',
        styleUrls: ['./task-form.component.css']
    })
    export class TaskFormComponent implements OnInit {
        constructor(private taskService: TaskService, private router: Router) { }

        submit(task: TaskForm) {
            const taskObservable = task.id ? this.taskService.updateTask(task) : this.taskService.addTask(task);

            taskObservable.subscribe(() => {
                this.router.navigate(['/']);
            });
        }
    }
    ```

</Steps>

## ‚úîÔ∏è Ce que vous avez appris

Vous avez appris √† envoyer une requ√™te **PUT** avec HttpClient pour mettre √† jour une t√¢che dans une application Angular.
